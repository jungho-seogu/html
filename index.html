<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>월별 아이템 매출 점도표</title>
  <!-- ✅ Plotly.js 라이브러리 -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <h2>월별 아이템 매출 점도표</h2>
  <div id="chart_div" style="width: 100%; height: 600px;"></div>

  <script>
    // ✅ 데이터 URL
    const DATA_URL = 'https://script.google.com/macros/s/AKfycbyyYJWkbTbR001BFrTq5AU_qpAZ3ttN-0cn1G6V5ASfqrKCkZg1yMqLdmXcWe94S0c/exec';

    async function drawChart() {
      const response = await fetch(DATA_URL);
      const json = await response.json();
      const data = json.data;

      // ✅ 아이템명 + 상품코드별 그룹핑
      const groupMap = {};

      data.forEach(d => {
        const key = `${d['아이템명']}_${d['상품코드']}`;
        if (!groupMap[key]) groupMap[key] = { x: [], y: [], text: [] };
        groupMap[key].x.push(d['월'].toString());
        groupMap[key].y.push(d['매출']);
        groupMap[key].text.push(`아이템명: ${d['아이템명']}<br>상품코드: ${d['상품코드']}<br>매출: ${d['매출'].toLocaleString()}`);
      });

      // ✅ Plotly traces 생성
      const traces = Object.keys(groupMap).map(key => ({
        x: groupMap[key].x,
        y: groupMap[key].y,
        text: groupMap[key].text,
        mode: 'markers',
        type: 'scatter',
        name: key,
        marker: { size: 8 }
      }));

      // ✅ 레이아웃
      const layout = {
        title: '월별 매출 점도표',
        xaxis: { title: '월', type: 'category' },
        yaxis: { title: '매출액', rangemode: 'tozero' },
        hovermode: 'closest'
      };

      // ✅ 차트 그리기
      Plotly.newPlot('chart_div', traces, layout);
    }

    drawChart();
  </script>
</body>
</html>
